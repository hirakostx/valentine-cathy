<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Cath √ó Momo üíò</title>

<style>
  :root{
    --yes:#ff2e63;
    --no:#222;
    --glass:rgba(255,255,255,.12);
    --border:rgba(255,255,255,.22);
    --shadow:rgba(0,0,0,.35);
    --txt:rgba(255,255,255,.95);
  }
  *{ box-sizing:border-box; }
  html,body{ margin:0; height:100%; overflow:hidden; }
  body{
    font-family:"Comic Sans MS", system-ui, sans-serif;
    background:#04050a;
    color:var(--txt);
    user-select:none;
  }

  /* ===== Background ===== */
  #bg{
    position:fixed; inset:0; z-index:0;
    width:100%; height:100%;
  }

  /* Cath √ó Momo pattern */
  .pattern{
    position:fixed;
    inset:-50%;
    z-index:1;
    pointer-events:none;
    opacity:1;
  }
  .pattern::before{
    content:"Cath √ó Momo   Cath √ó Momo   Cath √ó Momo   Cath √ó Momo   Cath √ó Momo   ";
    position:absolute;
    inset:0;
    font-size:3rem;
    opacity:.09;
    white-space:nowrap;
    transform: rotate(-20deg);
    animation: scroll 38s linear infinite;
  }
  @keyframes scroll{
    from{ transform: translateX(0) rotate(-20deg); }
    to{ transform: translateX(-50%) rotate(-20deg); }
  }

  /* Moon */
  .moon{
    position:fixed;
    top:10%;
    right:8%;
    width:140px;
    height:140px;
    border-radius:50%;
    background:radial-gradient(circle at 30% 30%, #fff, #d9d9d9 60%, #aaa 100%);
    box-shadow:0 0 40px rgba(255,255,255,.35);
    animation: moonFloat 6s ease-in-out infinite;
    z-index:1;
    pointer-events:none;
  }
  @keyframes moonFloat{
    0%,100%{ transform: translateY(0); }
    50%{ transform: translateY(-18px); }
  }

  /* ===== UI ===== */
  .ui{
    position:fixed; inset:0;
    z-index:2;
    display:flex;
    align-items:center;
    justify-content:center;
    pointer-events:none;
    padding:18px;
  }
  .card{
    pointer-events:auto;
    width:min(760px, 92vw);
    padding:22px;
    border-radius:26px;
    background: var(--glass);
    border:1px solid var(--border);
    box-shadow: 0 18px 60px var(--shadow);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    text-align:center;
    animation: pop .7s ease;
    position:relative;
    overflow:hidden;
  }
  @keyframes pop{
    from{ opacity:0; transform: translateY(10px) scale(.98); }
    to{ opacity:1; transform: translateY(0) scale(1); }
  }

  h1{
    margin:0 0 10px;
    font-size: clamp(2rem, 4vw, 3rem);
    text-shadow: 0 14px 30px rgba(0,0,0,.35);
    animation: pulse 2s infinite;
  }
  @keyframes pulse{
    0%,100%{ transform: scale(1); }
    50%{ transform: scale(1.05); }
  }
  .sub{
    margin: 2px 0 10px;
    opacity:.95;
  }

  .toast{
    min-height: 28px;
    display:flex;
    justify-content:center;
    align-items:center;
    gap:10px;
    font-size:1rem;
    opacity:.95;
    margin-bottom: 8px;
  }
  .toast span{
    display:inline-block;
    background: rgba(0,0,0,.22);
    border:1px solid rgba(255,255,255,.15);
    padding:6px 10px;
    border-radius: 999px;
    backdrop-filter: blur(8px);
  }

  .row{
    position:relative;
    height: 110px;
    margin-top: 8px;
  }

  button{
    position:absolute;
    top: 26px;
    border:none;
    border-radius: 999px;
    padding: 14px 28px;
    font-size: 1.15rem;
    cursor:pointer;
    box-shadow: 0 12px 28px rgba(0,0,0,.35);
    transition: transform .12s ease, filter .12s ease;
    user-select:none;
    will-change: left, top, transform;
  }
  button:active{ transform: scale(.98); }

  #yes{
    left: 28%;
    transform: translateX(-50%);
    background: var(--yes);
    color:white;
  }
  #yes:hover{ filter: brightness(1.06); }

  #no{
    left: 72%;
    transform: translateX(-50%);
    background: var(--no);
    color:white;
  }

  .tip{
    margin-top: 10px;
    font-size: .95rem;
    opacity: .9;
  }

  /* Emoji particles */
  .particle{
    position:fixed;
    top:-12vh;
    font-size: 2.2rem;
    pointer-events:none;
    z-index:5;
    filter: drop-shadow(0 12px 14px rgba(0,0,0,.28));
    will-change: transform, opacity;
  }

  /* Stars layer (more YES = more stars) */
  #stars{
    position:fixed;
    inset:0;
    z-index:1;
    pointer-events:none;
  }
  .star{
    position:absolute;
    font-size: 18px;
    opacity:.0;
    transform: translateY(0);
    animation: twinkle 2.2s ease-in-out infinite;
  }
  @keyframes twinkle{
    0%{ opacity:.0; transform: translateY(0) scale(.9); }
    40%{ opacity:.75; }
    60%{ opacity:.35; }
    100%{ opacity:.0; transform: translateY(-14px) scale(1.08); }
  }

  /* Shake */
  .shake{ animation: shake .45s ease; }
  @keyframes shake{
    0%,100%{ transform: translateX(0); }
    20%{ transform: translateX(-10px); }
    40%{ transform: translateX(10px); }
    60%{ transform: translateX(-8px); }
    80%{ transform: translateX(8px); }
  }

  /* Final button */
  .finalBtn{
    margin-top: 14px;
    position: static;
    display:inline-block;
    background: rgba(255,255,255,.15);
    border:1px solid rgba(255,255,255,.25);
    color:#fff;
    padding: 12px 18px;
    border-radius: 999px;
    cursor:pointer;
    box-shadow: 0 12px 28px rgba(0,0,0,.25);
    transition: transform .12s ease, filter .12s ease;
  }
  .finalBtn:hover{ transform: scale(1.06); filter: brightness(1.05); }

  /* Rukia overlay */
  #rukiaOverlay{
    position:fixed;
    inset:0;
    z-index:20;
    display:none;
    align-items:center;
    justify-content:center;
    background: rgba(0,0,0,.55);
    padding:18px;
  }
  .rukiaCard{
    width:min(760px, 92vw);
    padding:18px;
    border-radius: 26px;
    background: rgba(255,255,255,.10);
    border: 1px solid rgba(255,255,255,.22);
    backdrop-filter: blur(10px);
    text-align:center;
    box-shadow: 0 20px 70px rgba(0,0,0,.45);
    animation: pop .25s ease;
  }
  .rukiaAnim{
    width:min(420px, 82vw);
    aspect-ratio: 1 / 1;
    margin: 10px auto 8px;
    border-radius: 22px;
    background: rgba(255,255,255,.08);
    border: 1px solid rgba(255,255,255,.16);
    display:flex;
    align-items:center;
    justify-content:center;
    overflow:hidden;
    position:relative;
  }
  .rukiaAnim img{
    width:100%;
    height:100%;
    object-fit:cover;
    animation: rukiaFloat 2.8s ease-in-out infinite;
    filter: drop-shadow(0 16px 20px rgba(0,0,0,.35));
  }
  @keyframes rukiaFloat{
    0%,100%{ transform: translateY(0) scale(1.02); }
    50%{ transform: translateY(-12px) scale(1.04); }
  }
  .closeBtn{
    display:inline-block;
    margin-top: 10px;
    background: rgba(0,0,0,.35);
    border:1px solid rgba(255,255,255,.18);
    color:#fff;
    padding:10px 14px;
    border-radius:999px;
    cursor:pointer;
  }
</style>
</head>

<body>
  <canvas id="bg"></canvas>
  <div class="pattern"></div>
  <div id="stars"></div>
  <div class="moon"></div>

  <div class="ui">
    <div class="card" id="card">
      <h1>Veux-tu √™tre ma Valentine ? üíò</h1>
      <div class="sub">Cath √ó Momo üíï</div>

      <div class="toast"><span id="toastText">Choisis bien‚Ä¶ üòè</span></div>

      <div class="row" id="zone">
        <button id="yes">OUI üíñ</button>
        <button id="no">NON üò≠</button>
      </div>

      <div class="tip">Plus tu dis OUI‚Ä¶ plus il y a d‚Äô√©toiles ‚ú®</div>
    </div>
  </div>

  <!-- Final Rukia overlay -->
  <div id="rukiaOverlay">
    <div class="rukiaCard">
      <h2 style="margin:6px 0 10px;">Surprise üëÄ‚ú®</h2>

      <div class="rukiaAnim">
        <!-- Upload rukia.gif OR rukia.png in your repo root -->
        <img id="rukiaImg" src="rukia.gif" alt="Rukia animation"
             onerror="this.onerror=null; this.src='rukia.png';" />
      </div>

      <div style="opacity:.95;">
        Si √ßa ne s‚Äôaffiche pas : ajoute un fichier <b>rukia.gif</b> (ou <b>rukia.png</b>) √† la racine du repo.
      </div>

      <div class="closeBtn" id="closeRukia">Fermer</div>
    </div>
  </div>

<script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
<script>
/* =========================
   3D Minecraft-ish background (l√©ger + fluide)
   ========================= */
const canvas = document.getElementById("bg");
const renderer = new THREE.WebGLRenderer({ canvas, antialias:false, powerPreference:"high-performance" });
renderer.setPixelRatio(Math.min(2, window.devicePixelRatio || 1));

const scene = new THREE.Scene();
scene.background = new THREE.Color(0x06070c);

const camera = new THREE.PerspectiveCamera(55, 1, 0.1, 220);
camera.position.set(0, 10, 26);

scene.add(new THREE.HemisphereLight(0xffcce0, 0x2b2f55, 1.1));
const dir = new THREE.DirectionalLight(0xffffff, 0.65);
dir.position.set(10, 20, 10);
scene.add(dir);

const geo = new THREE.BoxGeometry(1,1,1);
const mat = new THREE.MeshLambertMaterial({ color: 0x4caf50 });

const size = 40;
const mesh = new THREE.InstancedMesh(geo, mat, size*size);
scene.add(mesh);

const dummy = new THREE.Object3D();
let k = 0;
for(let x=0;x<size;x++){
  for(let z=0;z<size;z++){
    const h = Math.sin(x*0.28)*0.9 + Math.cos(z*0.28)*0.9 + Math.sin((x+z)*0.15)*0.6;
    dummy.position.set(x - size/2, h, z - size/2);
    dummy.updateMatrix();
    mesh.setMatrixAt(k++, dummy.matrix);
  }
}

function resize(){
  renderer.setSize(innerWidth, innerHeight, false);
  camera.aspect = innerWidth / innerHeight;
  camera.updateProjectionMatrix();
}
addEventListener("resize", resize);
resize();

let mx = 0, my = 0;
addEventListener("mousemove", (e)=>{
  mx = (e.clientX / innerWidth - 0.5) * 2;
  my = (e.clientY / innerHeight - 0.5) * 2;
}, {passive:true});

function loop(t){
  requestAnimationFrame(loop);
  const tt = t * 0.00032;
  camera.position.x = Math.sin(tt) * 6 + mx * 2.2;
  camera.position.y = 10 + my * 1.6 + Math.sin(tt*1.7)*0.5;
  camera.position.z = 26 + Math.cos(tt) * 1.8;
  camera.lookAt(0, 2, 0);
  renderer.render(scene, camera);
}
requestAnimationFrame(loop);

/* =========================
   UI gameplay
   ========================= */
const yesBtn = document.getElementById("yes");
const noBtn  = document.getElementById("no");
const zone   = document.getElementById("zone");
const card   = document.getElementById("card");
const toast  = document.getElementById("toastText");
const starsLayer = document.getElementById("stars");

const rukiaOverlay = document.getElementById("rukiaOverlay");
const closeRukia = document.getElementById("closeRukia");

/* ---- helpers ---- */
function shake(){
  card.classList.remove("shake");
  void card.offsetWidth;
  card.classList.add("shake");
}

function particleRain(list, count){
  for(let i=0;i<count;i++){
    const p = document.createElement("div");
    p.className = "particle";
    p.textContent = list[Math.floor(Math.random()*list.length)];
    p.style.left = (Math.random()*100) + "vw";
    p.style.opacity = (Math.random()*0.45 + 0.55).toFixed(2);

    const dur = Math.random()*2200 + 2200;
    const size = Math.random()*18 + 34;
    p.style.fontSize = size + "px";

    document.body.appendChild(p);

    const startX = (Math.random()*40 - 20);
    const endX = (Math.random()*160 - 80);
    p.animate([
      { transform:`translate(${startX}px,0) rotate(0deg)`, opacity:p.style.opacity },
      { transform:`translate(${endX}px,120vh) rotate(${Math.random()*360}deg)`, opacity:0 }
    ], { duration: dur, easing:"linear" });

    setTimeout(()=>p.remove(), dur + 50);
  }
}

/* ---- Stars amount grows with YES count ---- */
let yesCount = 0;
function addStars(extra){
  for(let i=0;i<extra;i++){
    const s = document.createElement("div");
    s.className = "star";
    s.textContent = (Math.random() < 0.6) ? "‚ú®" : "‚≠ê";
    s.style.left = (Math.random()*100) + "vw";
    s.style.top  = (Math.random()*100) + "vh";
    s.style.animationDuration = (Math.random()*1.2 + 1.6) + "s";
    starsLayer.appendChild(s);
    // remove and respawn to keep it light
    setTimeout(()=> s.remove(), 2600);
  }
}

/* ---- NO ‚Äúhesitation‚Äù phrases + soft dodge ---- */
const noPhrasesHover = [
  "T‚Äôes s√ªre de toi ? üò≥",
  "Attends‚Ä¶ r√©fl√©chis üò≠",
  "Tu rigoles pas l√† ? ü´£",
  "Vraiment NON ? üíî",
  "Derni√®re chance‚Ä¶ üò§"
];
const noPhrasesClick = [
  "A√Øe‚Ä¶ √ßa fait mal üíî",
  "Tu me brises Cath √ó Momo üò≠",
  "Non non non‚Ä¶ re-choisis üò§",
  "Ok‚Ä¶ mais je pleure üò≠üò≠",
  "Stop‚Ä¶ reviens sur OUI ü•∫"
];
let noHoverIndex = 0;
let noClickIndex = 0;

function setNoPos(leftPx, topPx){
  const rZ = zone.getBoundingClientRect();
  const rB = noBtn.getBoundingClientRect();
  const bw = rB.width, bh = rB.height;

  const x = Math.max(10, Math.min(leftPx, rZ.width - bw - 10));
  const y = Math.max(10, Math.min(topPx, rZ.height - bh - 10));
  noBtn.style.left = (x + bw/2) + "px";
  noBtn.style.top  = y + "px";
  noBtn.style.transform = "translateX(-50%)";
}

function nudgeNoAway(mouseX, mouseY){
  const rZ = zone.getBoundingClientRect();
  const rB = noBtn.getBoundingClientRect();
  const nbx = (rB.left + rB.width/2) - rZ.left;
  const nby = (rB.top + rB.height/2) - rZ.top;

  const dx = mouseX - nbx;
  const dy = mouseY - nby;
  const dist = Math.hypot(dx, dy);

  // move gently away when close
  if(dist < 110){
    const push = 130;
    const px = nbx - (dx/(dist||1))*push;
    const py = nby - (dy/(dist||1))*(push*0.25);
    setNoPos(px - rB.width/2, py - 18);
  }
}

zone.addEventListener("mousemove", (e)=>{
  const rz = zone.getBoundingClientRect();
  const mx = e.clientX - rz.left;
  const my = e.clientY - rz.top;
  nudgeNoAway(mx, my);
}, {passive:true});

noBtn.addEventListener("mouseenter", ()=>{
  toast.textContent = noPhrasesHover[noHoverIndex % noPhrasesHover.length];
  noHoverIndex++;
  // tiny move to ‚Äúhesitate‚Äù
  const rz = zone.getBoundingClientRect();
  setNoPos((Math.random()*(rz.width*0.55) + rz.width*0.35), 26);
});

noBtn.addEventListener("click", ()=>{
  toast.textContent = noPhrasesClick[noClickIndex % noPhrasesClick.length];
  noClickIndex++;
  shake();
  particleRain(["üíî","üò≠","ü•≤","üò§","ü´†"], 42);
});

/* ---- YES ‚Äúhesitation‚Äù + increasing stars ---- */
const yesSteps = [
  "T‚Äôes s√ªre ? üò≥",
  "Genre OUI OUI ? üíò",
  "Apr√®s √ßa c‚Äôest s√©rieux üòè",
  "Derni√®re confirmation‚Ä¶ üíç",
  "OK‚Ä¶ on y va üòç"
];

yesBtn.addEventListener("click", ()=>{
  yesCount++;
  addStars(8 + yesCount*6);            // more yes = more stars
  particleRain(["‚ú®","üíñ","üíò","‚≠ê"], 14 + yesCount*6);

  if(yesCount < 5){
    toast.textContent = yesSteps[yesCount-1];
    // make YES ‚Äúplay‚Äù a little
    yesBtn.style.transform = "translateX(-50%) scale(1.06)";
    setTimeout(()=> yesBtn.style.transform = "translateX(-50%)", 140);
    return;
  }

  // Final screen
  card.innerHTML = `
    <h1>Cath √ó Momo üíñ</h1>
    <div class="sub">C‚Äô√©tait √©crit sous la lune üåô</div>
    <div class="sub">Valentine officielle üíç‚ú®</div>
    <div style="margin-top:10px;opacity:.95;">(Plus tu as dit OUI, plus le ciel brille ‚≠ê)</div>
    <div class="finalBtn" id="finalBtn">Clique tu verras üëÄ</div>
    <div class="tip">Si l‚Äôanimation n‚Äôappara√Æt pas, ajoute <b>rukia.gif</b> (ou <b>rukia.png</b>) dans le repo.</div>
  `;

  // Big star celebration based on yesCount
  addStars(60 + yesCount*25);
  particleRain(["‚≠ê","‚ú®","üíñ","üíò","üåô"], 120);

  // hook final button
  const finalBtn = document.getElementById("finalBtn");
  finalBtn.addEventListener("click", ()=>{
    rukiaOverlay.style.display = "flex";
    particleRain(["‚ú®","‚≠ê","üíñ"], 70);
  });
});

/* Close overlay */
closeRukia.addEventListener("click", ()=>{
  rukiaOverlay.style.display = "none";
});

/* Clicking outside closes too */
rukiaOverlay.addEventListener("click", (e)=>{
  if(e.target === rukiaOverlay) rukiaOverlay.style.display = "none";
});

/* start NO position stable */
window.addEventListener("load", ()=>{
  const rz = zone.getBoundingClientRect();
  setNoPos(rz.width*0.62, 26);
});
</script>
</body>
</html>
