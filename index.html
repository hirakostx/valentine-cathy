<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Valentine Cathy üíò</title>

  <style>
    :root{
      --glass: rgba(255,255,255,.14);
      --border: rgba(255,255,255,.20);
      --shadow: rgba(0,0,0,.35);
      --yes: #ff2e63;
      --no: #222;
      --txt: rgba(255,255,255,.95);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; margin:0; }

    body{
      overflow:hidden;
      font-family: "Comic Sans MS", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:#05060a;
      color:var(--txt);
    }

    /* --- 3D background canvas --- */
    #bg{
      position:fixed;
      inset:0;
      width:100%;
      height:100%;
      z-index:0;
      display:block;
    }

    /* --- UI overlay --- */
    .ui{
      position:fixed;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:2;
      pointer-events:none; /* only cards/buttons re-enable */
      padding: 18px;
    }

    .card{
      pointer-events:auto;
      width:min(760px, 92vw);
      text-align:center;
      padding: 18px;
      border-radius: 26px;
      background: var(--glass);
      border:1px solid var(--border);
      box-shadow: 0 18px 60px var(--shadow);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      animation: popIn .7s ease;
    }

    h1{
      margin: 6px 0 10px;
      font-size: clamp(2rem, 4.2vw, 3.2rem);
      text-shadow: 0 14px 30px rgba(0,0,0,.35);
      animation: pulse 1.8s infinite;
    }

    .sub{
      margin: 4px 0 12px;
      opacity:.95;
      font-size: 1rem;
    }

    .imgBox{ display:flex; justify-content:center; margin: 10px 0 6px; }
    img.photo{
      width:min(360px, 86vw);
      border-radius: 22px;
      box-shadow: 0 16px 44px rgba(0,0,0,.45);
      animation: float 3s ease-in-out infinite;
      background: rgba(255,255,255,.08);
    }

    .row{
      position:relative;
      height: 96px; /* zone de jeu pour le bouton NON */
      margin-top: 12px;
    }

    button.btn{
      position:absolute;
      top: 18px;
      border:none;
      border-radius: 999px;
      padding: 14px 26px;
      font-size: 1.15rem;
      cursor:pointer;
      box-shadow: 0 12px 28px rgba(0,0,0,.28);
      transition: transform .12s ease, filter .12s ease;
      user-select:none;
      will-change: transform, left, top;
    }
    button.btn:active{ transform: scale(.98); }

    #yesBtn{
      left: 26%;
      transform: translateX(-50%);
      background: var(--yes);
      color:#fff;
    }
    #yesBtn:hover{ transform: translateX(-50%) scale(1.06); filter:brightness(1.05); }

    #noBtn{
      left: 74%;
      transform: translateX(-50%);
      background: var(--no);
      color:#fff;
    }

    .tip{
      margin-top:10px;
      font-size:.95rem;
      opacity:.92;
    }

    .tiny{
      margin-top:6px;
      font-size:.9rem;
      opacity:.85;
    }

    /* --- modal --- */
    .modalOverlay{
      position:fixed; inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      z-index:5;
      background: rgba(0,0,0,.42);
      padding: 18px;
    }
    .modal{
      width:min(560px, 92vw);
      background: rgba(255,255,255,.93);
      color:#111;
      border-radius: 22px;
      padding: 16px 14px;
      box-shadow: 0 22px 70px rgba(0,0,0,.45);
      text-align:center;
      animation: popIn .2s ease;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    .modal h2{ margin: 4px 0 10px; }
    .modal p{ margin: 0 0 14px; }
    .mrow{ display:flex; gap:10px; justify-content:center; flex-wrap:wrap; }
    .mBtn{
      border:none;
      border-radius:999px;
      padding: 10px 16px;
      font-weight: 800;
      cursor:pointer;
    }
    .mYes{ background:#ff2e63; color:#fff; }
    .mNo{ background:#111; color:#fff; }
    .mOk{ background:#1f8bff; color:#fff; }

    /* --- effects --- */
    .shake{ animation: shake .45s ease; }

    @keyframes popIn{
      from{ opacity:0; transform: translateY(10px) scale(.98); }
      to{ opacity:1; transform: translateY(0) scale(1); }
    }
    @keyframes pulse{
      0%,100%{ transform: scale(1); }
      50%{ transform: scale(1.04); }
    }
    @keyframes float{
      0%,100%{ transform: translateY(0); }
      50%{ transform: translateY(-12px); }
    }
    @keyframes shake{
      0%,100%{ transform: translateX(0); }
      20%{ transform: translateX(-10px); }
      40%{ transform: translateX(10px); }
      60%{ transform: translateX(-8px); }
      80%{ transform: translateX(8px); }
    }

    /* --- Twemoji SVG particles (ultra net) --- */
    .emoji{
      position:fixed;
      top:-12vh;
      width: 42px;
      height: 42px;
      pointer-events:none;
      z-index:6;
      filter: drop-shadow(0 12px 14px rgba(0,0,0,.28));
      will-change: transform, opacity;
    }

    /* small FPS badge */
    #fpsBadge{
      position:fixed;
      bottom:12px; left:12px;
      z-index:10;
      background: rgba(0,0,0,.35);
      border: 1px solid rgba(255,255,255,.18);
      color: rgba(255,255,255,.9);
      padding: 6px 10px;
      border-radius: 999px;
      font: 700 12px/1.2 system-ui, -apple-system, Segoe UI, Roboto, Arial;
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      user-select:none;
    }
  </style>
</head>

<body>
  <canvas id="bg"></canvas>

  <div class="ui">
    <div class="card" id="card">
      <h1>Veux-tu √™tre ma Valentine Cathy ? üíò</h1>

      <div class="imgBox">
        <img class="photo" id="mainImg" src="debut.jpg" alt="debut"
          onerror="this.style.display='none'; document.getElementById('imgErr').style.display='block';" />
      </div>

      <div id="imgErr" style="display:none; padding:10px; font-size:.95rem;">
        ‚ö†Ô∏è Image introuvable.<br>
        Renomme ton fichier exactement <b>debut.jpg</b> et mets-le √† la racine du repo.
      </div>

      <div class="sub">R√©ponds honn√™tement‚Ä¶ üòá</div>

      <div class="row" id="playZone">
        <button class="btn" id="yesBtn">OUI üíñ</button>
        <button class="btn" id="noBtn">NON üò≠</button>
      </div>

      <div class="tip">Le bouton NON est timide‚Ä¶ il esquive üòè</div>
      <div class="tiny">Si tu vois l‚Äôancienne version : ouvre en navigation priv√©e ou ajoute <b>?v=123</b> √† l‚ÄôURL.</div>
    </div>
  </div>

  <div class="modalOverlay" id="modalOverlay">
    <div class="modal">
      <h2 id="mTitle">T‚Äôes s√ªre ? üò≥</h2>
      <p id="mText">Parce que moi je suis TR√àS s√©rieux l√†‚Ä¶ üíò</p>
      <div class="mrow" id="mRow"></div>
    </div>
  </div>

  <div id="fpsBadge">FPS: --</div>

  <!-- three.js for the 3D minecraft-ish background -->
  <script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
  <!-- Twemoji for ultra clean SVG emojis -->
  <script src="https://unpkg.com/twemoji@14.0.2/dist/twemoji.min.js"></script>

  <script>
    /*********************
     * 3D "Minecraft-ish" background
     * - Instanced voxel grid
     * - Moving camera for parallax
     * - Simple pixel-ish colors (no copyrighted textures)
     *********************/
    const canvas = document.getElementById('bg');
    const renderer = new THREE.WebGLRenderer({
      canvas,
      antialias: false,
      powerPreference: "high-performance",
      alpha: false
    });
    renderer.setPixelRatio(Math.min(2, window.devicePixelRatio || 1));

    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x06070c);

    const camera = new THREE.PerspectiveCamera(55, 1, 0.1, 200);
    camera.position.set(0, 10, 26);

    // Lights
    const hemi = new THREE.HemisphereLight(0xffcfe0, 0x2b2f55, 1.1);
    scene.add(hemi);
    const dir = new THREE.DirectionalLight(0xffffff, 0.65);
    dir.position.set(10, 18, 12);
    scene.add(dir);

    // Voxel instancing
    const boxGeo = new THREE.BoxGeometry(1,1,1);

    // A slightly "pixel" look by using MeshLambertMaterial (fast)
    const mat = new THREE.MeshLambertMaterial({ vertexColors: true });

    const sizeX = 44, sizeZ = 44;
    const count = sizeX * sizeZ;
    const mesh = new THREE.InstancedMesh(boxGeo, mat, count);
    mesh.instanceMatrix.setUsage(THREE.DynamicDrawUsage);
    scene.add(mesh);

    // Per-instance colors
    const color = new THREE.Color();
    const colors = new Float32Array(count * 3);
    const dummy = new THREE.Object3D();

    // Height map (simple, smooth)
    const heights = new Float32Array(count);
    let idx = 0;
    for (let x=0; x<sizeX; x++){
      for (let z=0; z<sizeZ; z++){
        const nx = (x - sizeX/2) / (sizeX/2);
        const nz = (z - sizeZ/2) / (sizeZ/2);
        // smooth-ish terrain
        const h = 2.2*Math.sin(nx*2.8) + 2.0*Math.cos(nz*2.6) + 1.4*Math.sin((nx+nz)*3.0);
        heights[idx++] = h;
      }
    }

    // assign instances
    idx = 0;
    for (let x=0; x<sizeX; x++){
      for (let z=0; z<sizeZ; z++){
        const i = idx++;
        const h = heights[i];

        // position
        dummy.position.set(
          (x - sizeX/2) * 1.05,
          Math.max(-2.5, h*0.55),
          (z - sizeZ/2) * 1.05
        );

        // random slight scale variation (keeps it "blocky")
        const s = 1.0;
        dummy.scale.set(s, s, s);
        dummy.rotation.set(0, 0, 0);
        dummy.updateMatrix();
        mesh.setMatrixAt(i, dummy.matrix);

        // color like minecraft-ish (grass/dirt/stone) without textures
        // top areas greener, low areas darker/stone
        const t = THREE.MathUtils.clamp((h + 4) / 8, 0, 1);
        // blend
        const r = THREE.MathUtils.lerp(0.18, 0.38, t);
        const g = THREE.MathUtils.lerp(0.22, 0.62, t);
        const b = THREE.MathUtils.lerp(0.28, 0.34, t);
        color.setRGB(r, g, b);

        colors[i*3+0] = color.r;
        colors[i*3+1] = color.g;
        colors[i*3+2] = color.b;
      }
    }

    mesh.geometry.setAttribute('color', new THREE.InstancedBufferAttribute(colors, 3));

    function resize(){
      const w = window.innerWidth;
      const h = window.innerHeight;
      renderer.setSize(w, h, false);
      camera.aspect = w / h;
      camera.updateProjectionMatrix();
    }
    window.addEventListener('resize', resize);
    resize();

    // Mouse parallax
    let mx = 0, my = 0;
    window.addEventListener('mousemove', (e)=>{
      mx = (e.clientX / window.innerWidth) * 2 - 1;
      my = (e.clientY / window.innerHeight) * 2 - 1;
    }, {passive:true});

    // FPS badge
    const fpsBadge = document.getElementById('fpsBadge');
    let lastT = performance.now(), frames = 0, fps = 0;

    function animate(t){
      requestAnimationFrame(animate);

      // FPS calc
      frames++;
      if (t - lastT >= 500){
        fps = Math.round((frames * 1000) / (t - lastT));
        fpsBadge.textContent = "FPS: " + fps;
        frames = 0;
        lastT = t;
      }

      // camera motion
      const tt = t * 0.00035;
      const orbit = 26;
      const camX = Math.sin(tt) * 8 + mx * 1.5;
      const camZ = orbit + Math.cos(tt) * 2;
      const camY = 10 + Math.sin(tt*1.7)*0.8 - my*1.2;

      camera.position.set(camX, camY, camZ);
      camera.lookAt(0, 2.5, 0);

      renderer.render(scene, camera);
    }
    requestAnimationFrame(animate);

    /*********************
     * UI logic: NO dodges, YES hesitation modal, SVG emoji rain
     *********************/
    const yesBtn = document.getElementById('yesBtn');
    const noBtn  = document.getElementById('noBtn');
    const playZone = document.getElementById('playZone');
    const card = document.getElementById('card');

    const modalOverlay = document.getElementById('modalOverlay');
    const mTitle = document.getElementById('mTitle');
    const mText  = document.getElementById('mText');
    const mRow   = document.getElementById('mRow');

    function clamp(v, min, max){ return Math.max(min, Math.min(max, v)); }

    function setNoPos(leftPx, topPx){
      const zone = playZone.getBoundingClientRect();
      const btn = noBtn.getBoundingClientRect();
      const bw = btn.width, bh = btn.height;

      const x = clamp(leftPx, 10, zone.width - bw - 10);
      const y = clamp(topPx, 8, zone.height - bh - 8);

      noBtn.style.left = (x + bw/2) + "px";
      noBtn.style.top  = y + "px";
      noBtn.style.transform = "translateX(-50%)";
    }

    function randomizeNo(){
      const zone = playZone.getBoundingClientRect();
      const btn = noBtn.getBoundingClientRect();
      const bw = btn.width, bh = btn.height;

      const x = Math.random() * (zone.width - bw - 20) + 10;
      const y = Math.random() * (zone.height - bh - 16) + 8;
      setNoPos(x, y);
    }

    function shake(){
      card.classList.remove('shake');
      void card.offsetWidth;
      card.classList.add('shake');
    }

    // Ultra clean emoji rain using Twemoji SVG
    function twemojiUrl(emoji){
      const codepoint = twemoji.convert.toCodePoint(emoji);
      return `https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/svg/${codepoint}.svg`;
    }

    function rain(emojis, count){
      for(let i=0;i<count;i++){
        const img = document.createElement('img');
        img.className = "emoji";
        const em = emojis[Math.floor(Math.random()*emojis.length)];
        img.src = twemojiUrl(em);
        img.alt = em;

        img.style.left = (Math.random()*100) + "vw";
        img.style.opacity = (Math.random()*0.45 + 0.55).toFixed(2);

        const size = Math.random()*26 + 34; // 34..60
        img.style.width = size + "px";
        img.style.height = size + "px";

        const dur = Math.random()*2200 + 2200;
        document.body.appendChild(img);

        const startX = (Math.random()*40 - 20);
        const endX = (Math.random()*160 - 80);
        img.animate([
          { transform:`translate(${startX}px,0) rotate(0deg)`, opacity: img.style.opacity },
          { transform:`translate(${endX}px,120vh) rotate(${Math.random()*360}deg)`, opacity: 0 }
        ], { duration: dur, easing: 'linear' });

        setTimeout(()=> img.remove(), dur + 40);
      }
    }

    // NO dodges mouse
    playZone.addEventListener('mousemove', (ev)=>{
      const zone = playZone.getBoundingClientRect();
      const bx = ev.clientX - zone.left;
      const by = ev.clientY - zone.top;

      const nb = noBtn.getBoundingClientRect();
      const nbx = (nb.left + nb.width/2) - zone.left;
      const nby = (nb.top + nb.height/2) - zone.top;

      const dx = bx - nbx;
      const dy = by - nby;
      const dist = Math.hypot(dx, dy);

      if(dist < 95){
        const push = 150;
        const px = nbx - (dx / (dist || 1)) * push;
        const py = nby - (dy / (dist || 1)) * (push * 0.30);
        setNoPos(px - (nb.width/2), py - 18);
      }
    }, {passive:true});

    noBtn.addEventListener('mouseenter', randomizeNo);
    noBtn.addEventListener('touchstart', (e)=>{ e.preventDefault(); randomizeNo(); }, {passive:false});

    // NO click drama
    let noClicks = 0;
    noBtn.addEventListener('click', ()=>{
      noClicks++;
      shake();
      rain(["üíî","üò≠","üò°","ü•≤","üò§","ü´†"], 48);

      const msgs = [
        "EH ??? üò≠",
        "T‚Äôes s√©rieuse l√† ? üíî",
        "Non non non‚Ä¶ re-choisis üò§",
        "Cathy stp‚Ä¶ j‚Äôai le c≈ìur fragile ü•∫",
        "Tu peux pas dire non √† √ßa‚Ä¶ üò≠üíî",
        "DERNI√àRE CHANCE üò≠üò≠"
      ];
      alert(msgs[Math.min(noClicks-1, msgs.length-1)]);
      randomizeNo();
    });

    // YES hesitation modal flow
    const steps = [
      { title:"T‚Äôes s√ªre de √ßa ? üò≥", text:"Genre‚Ä¶ vraiment vraiment ? üíò", buttons:[["Oui j‚Äôsuis s√ªre üíñ","next"],["Euh‚Ä¶ attends ü§≠","close"]] },
      { title:"R√©fl√©chis bien üò≠", text:"Parce que moi je dis OUI direct üòç", buttons:[["OK OUI üíò","next"],["Je panique üòµ","close"]] },
      { title:"Derni√®re confirmation üò§", text:"Apr√®s √ßa, c‚Äôest officiel üòèüíç", buttons:[["OUIII üòçüíñ","final"],["J‚Äôai peur üò≠","close"]] }
    ];
    let stepIndex = 0;

    function openModal(step){
      modalOverlay.style.display = "flex";
      mTitle.textContent = step.title;
      mText.textContent  = step.text;
      mRow.innerHTML = "";

      step.buttons.forEach(([label, action])=>{
        const b = document.createElement('button');
        b.className = "mBtn " + (action === "final" ? "mYes" : action === "next" ? "mOk" : "mNo");
        b.textContent = label;
        b.onclick = ()=> onModal(action);
        mRow.appendChild(b);
      });
    }
    function closeModal(){ modalOverlay.style.display = "none"; }

    function onModal(action){
      if(action === "close"){
        closeModal();
        shake();
        rain(["ü´£","üò≥","üôÉ","üòµ"], 24);
        alert("ü§£ vas-y‚Ä¶ clique OUI quand t‚Äôes pr√™te !");
        return;
      }
      if(action === "next"){
        stepIndex = Math.min(stepIndex + 1, steps.length - 1);
        openModal(steps[stepIndex]);
        return;
      }
      if(action === "final"){
        closeModal();
        successScreen();
      }
    }

    yesBtn.addEventListener('click', ()=>{
      stepIndex = 0;
      openModal(steps[0]);
      rain(["‚ú®","üíò","üíñ"], 18);
    });

    modalOverlay.addEventListener('click', (e)=>{
      if(e.target === modalOverlay) closeModal();
    });

    function successScreen(){
      document.querySelector('.ui').innerHTML = `
        <div class="card" id="card2">
          <h1>OUIIIII üòçüíòüíûüíñ</h1>
          <div class="imgBox">
            <img class="photo" src="oui.jpg" alt="oui"
              onerror="this.style.display='none'; document.getElementById('imgErr2').style.display='block';" />
          </div>
          <div id="imgErr2" style="display:none; padding:10px; font-size:.95rem;">
            ‚ö†Ô∏è Image introuvable.<br>
            Renomme ton fichier exactement <b>oui.jpg</b> et mets-le √† la racine du repo.
          </div>
          <div class="sub" style="font-size:1.15rem; margin-top:8px;">
            Cathy üíï tu viens de me rendre trop heureux üò≠‚ù§Ô∏è
          </div>
          <div class="sub">Officiel : ma Valentine üíçüíñ</div>
          <div class="tiny">(capture d‚Äô√©cran obligatoire üòå)</div>
        </div>
      `;
      rain(["üíñ","üíò","üòç","ü•∞","‚ù§Ô∏è","üíû","üåπ","‚ú®"], 110);
      setTimeout(()=> rain(["üíñ","üíò","üòç","ü•∞","‚ù§Ô∏è","üíû","üåπ","‚ú®"], 130), 650);
    }

    // initial NO position once layout is ready
    window.addEventListener('load', ()=> {
      randomizeNo();
      // warm emoji small burst to show quality
      rain(["‚ú®","üíñ"], 8);
    });
  </script>
</body>
</html>
